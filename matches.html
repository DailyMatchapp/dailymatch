<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جدول المباريات | Daily Match</title>
     <link rel="icon" type="image/png" href="https://i.ibb.co/KzXmmxST/channels4-profile.jpg">
    <!-- أيقونات -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- خط -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;500;700;900&display=swap" rel="stylesheet">

<style>
/* =========================================
   1. الأساسيات والمتغيرات
========================================= */
:root {
    --bg-color: #0b0f19;
    --card-bg: #151b2b;
    --match-card-bg: #1e293b;
    --text-main: #ffffff;
    --text-muted: #94a3b8;
    --accent-gradient: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
    --glass-border: 1px solid rgba(255, 255, 255, 0.1);
    --highlight-color: #00ccff;
}

* { margin: 0; padding: 0; box-sizing: border-box; outline: none; font-family: 'Cairo', sans-serif; }
body { background-color: var(--bg-color); color: var(--text-main); direction: rtl; line-height: 1.6; overflow-x: hidden; }

/* شريط التمرير */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #0b0f19; }
::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }

/* =========================================
   2. القائمة العلوية (Navbar)
========================================= */
.navbar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 1rem 5%; background: rgba(11, 15, 25, 0.95);
    backdrop-filter: blur(10px); border-bottom: var(--glass-border);
    position: sticky; top: 0; z-index: 1000;
}
.logo {
    font-size: 1.5rem; font-weight: 900;
    background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-decoration: none;
}
.nav-links a {
    color: var(--text-muted); text-decoration: none; margin-right: 20px; font-weight: 500; transition: 0.3s;
}
.nav-links a:hover, .nav-links a.active { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }

/* =========================================
   3. الحاوية والتصميم
========================================= */
.container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; min-height: 80vh; }

.section-wrapper {
    background: var(--card-bg); border: var(--glass-border);
    padding: 2rem; border-radius: 16px; margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    display: none; /* مخفي افتراضياً حتى يتم تحميل المحتوى */
}

.section-title {
    text-align: center; color: #fff; margin-bottom: 25px;
    position: relative; padding-bottom: 10px; font-size: 1.4rem;
}
.section-title::after {
    content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 50px; height: 3px; background: var(--accent-gradient); border-radius: 3px;
}

/* رسالة لا يوجد مباريات */
.no-matches-global {
    text-align: center; padding: 50px 20px; color: var(--text-muted);
    background: var(--card-bg); border-radius: 16px; border: var(--glass-border);
    display: none; /* تظهر بالجافاسكربت */
}

/* =========================================
   4. بطاقة المباراة
========================================= */
.matches-grid { display: grid; gap: 15px; grid-template-columns: 1fr; }

.match-card {
    background: var(--match-card-bg); border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 12px; padding: 15px; position: relative; overflow: hidden;
    transition: 0.3s;
}
.match-card:hover { transform: translateY(-3px); border-color: #3b82f6; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }

/* تفاصيل الفريقين */
.match-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
.team-box { flex: 1; display: flex; flex-direction: column; align-items: center; text-align: center; }
.team-box img { width: 45px; height: 45px; object-fit: contain; margin-bottom: 8px; }
.team-name { font-size: 13px; font-weight: 700; color: #fff; }
.center-box { width: 80px; text-align: center; }
.score { font-size: 22px; font-weight: 900; color: var(--highlight-color); letter-spacing: 2px; }

/* الحالة */
.match-status { padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; display: inline-block; margin-top: 5px; }
.status-live { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
.status-live::after { content: " ●"; animation: blink 1s infinite; }
.status-soon { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
.status-finished { background: rgba(148, 163, 184, 0.2); color: #94a3b8; }
@keyframes blink { 50% { opacity: 0; } }

/* الدوري */
.league-info { text-align: center; margin-bottom: 15px; font-size: 12px; color: #cbd5e1; display: flex; align-items: center; justify-content: center; gap: 5px; }
.league-info img { width: 18px; height: 18px; border-radius: 50%; background: #fff; }

/* الأزرار */
.actions-row { display: flex; justify-content: center; gap: 10px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 10px; }
.btn-action {
    display: inline-flex; align-items: center; gap: 5px; padding: 6px 14px;
    border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer;
    text-decoration: none; transition: 0.3s; border: none; outline: none;
}
.btn-channels { background: rgba(255,255,255,0.08); color: #cbd5e1; }
.btn-channels:hover { background: rgba(255,255,255,0.15); color: #fff; }
.btn-watch { background: var(--accent-gradient); color: #fff; box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
.btn-watch:hover { box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); transform: scale(1.05); }

/* قائمة القنوات */
.channels-list { margin-top: 10px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; text-align: center; display: none; }
.channels-list.active { display: block; animation: fadeIn 0.3s; }
.channel-item { font-size: 11px; color: #e2e8f0; margin: 2px 0; }

/* =========================================
   5. مشغل الفيديو (MODAL / POPUP)
========================================= */
.video-modal {
    display: none; position: fixed; z-index: 2000; left: 0; top: 0;
    width: 100%; height: 100%; overflow: auto;
    background-color: rgba(0,0,0,0.9); backdrop-filter: blur(5px);
    align-items: center; justify-content: center;
}
.modal-content {
    position: relative; background: #000; margin: auto; padding: 0;
    width: 90%; max-width: 800px; aspect-ratio: 16/9;
    border-radius: 10px; border: 1px solid #333; box-shadow: 0 0 50px rgba(59, 130, 246, 0.2);
}
.close-modal {
    position: absolute; top: -35px; right: 0; color: #fff;
    font-size: 30px; font-weight: bold; cursor: pointer; transition: 0.3s;
}
.close-modal:hover { color: #f44336; }
iframe { width: 100%; height: 100%; border: none; border-radius: 10px; }

/* =========================================
   6. التجاوب والفوتر
========================================= */
@media (max-width: 600px) {
    .match-row { gap: 5px; }
    .team-box img { width: 35px; height: 35px; }
    .team-name { font-size: 11px; }
    .score { font-size: 18px; }
    .nav-links { display: none; } /* يفضل عمل قائمة منسدلة للهاتف */
}

footer { text-align: center; padding: 2rem; border-top: var(--glass-border); color: var(--text-muted); background: rgba(11, 15, 25, 0.95); margin-top: auto; }
</style>
</head>
<body>

    <!-- القائمة العلوية -->
    <nav class="navbar">
        <a href="index.html" class="logo">Daily Match</a>
        <div class="nav-links">
            <a href="index.html">الرئيسية</a>
            <a href="matches.html" class="active">المباريات</a>
            <a href="contact.html">اتصل بنا</a>
            <a href="privacy.html">الخصوصية</a>
        </div>
    </nav>

    <!-- المحتوى الرئيسي -->
    <div class="container">
        
        <!-- لودنج -->
        <div id="loading" style="text-align:center; padding:50px; color:#3b82f6;">
            <i class='bx bx-loader-alt bx-spin' style="font-size:40px;"></i>
            <p style="margin-top:10px;">جاري جلب المباريات...</p>
        </div>

        <!-- قسم كرة القدم -->
        <div id="footballSection" class="section-wrapper">
            <h2 class="section-title">مباريات كرة القدم</h2>
            <div class="matches-grid" id="footballMatches"></div>
        </div>

        <!-- قسم UFC -->
        <div id="ufcSection" class="section-wrapper">
            <h2 class="section-title">نزالات UFC</h2>
            <div class="matches-grid" id="ufcMatches"></div>
        </div>

        <!-- قسم الملاكمة -->
        <div id="boxingSection" class="section-wrapper">
            <h2 class="section-title">نزالات الملاكمة</h2>
            <div class="matches-grid" id="boxingMatches"></div>
        </div>

        <!-- رسالة لا يوجد مباريات (عامة) -->
        <div id="globalNoMatches" class="no-matches-global">
            <i class='bx bx-calendar-x' style="font-size: 50px; margin-bottom: 15px;"></i>
            <h3>لا توجد مباريات أو نزالات مجدولة اليوم</h3>
            <p>يرجى التحقق لاحقاً أو غداً</p>
        </div>

    </div>

    <!-- نافذة الفيديو المنبثقة -->
    <div id="videoModal" class="video-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeVideo()">&times;</span>
            <iframe id="videoFrame" src="" allowfullscreen allow="autoplay; encrypted-media"></iframe>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Daily Match. جميع الحقوق محفوظة.</p>
    </footer>

<!-- =========================================
   JAVASCRIPT
========================================= -->
<script>
// إعدادات الـ API
const todayDate = new Date().toISOString().slice(0, 10);
const time = new Date().getMinutes();
const API_URL = `https://ws.kora-api.top/api/matches/${todayDate}?t=${time}`;
const MAIN_URL_BASE = 'https://ws.kora-api.top/live/'; // الرابط الأساسي للمشاهدة
const TEAM_IMG_URL = 'https://ws.kora-api.top/uploads/team/';
const LEAGUE_IMG_URL = 'https://ws.kora-api.top/uploads/league/';

// عناصر DOM
const loadingDiv = document.getElementById("loading");
const globalNoMatches = document.getElementById("globalNoMatches");

// الدوريات المحظورة (اختياري)
const blockedLeagues = [
    /NBA/i, /Formula 1/i, /NFL/i, /MotoGP/i, 
    /الدوري البرازيلي/i, /الدوري الإسكتلندي/i
];

// 1. دالة جلب البيانات
async function fetchMatches() {
    try {
        const response = await fetch(API_URL);
        const data = await response.json();
        
        loadingDiv.style.display = "none";

        if (!data || data.length === 0) {
            showGlobalNoMatches();
            return;
        }

        // توزيع المباريات
        const countFootball = processMatches(data, 'football', 'footballSection', 'footballMatches');
        const countUFC = processMatches(data, 'ufc', 'ufcSection', 'ufcMatches');
        const countBoxing = processMatches(data, 'boxing', 'boxingSection', 'boxingMatches');

        // إذا لم يتم العثور على أي مباراة في أي قسم
        if (countFootball === 0 && countUFC === 0 && countBoxing === 0) {
            showGlobalNoMatches();
        }

    } catch (error) {
        console.error("Error fetching matches:", error);
        loadingDiv.innerHTML = "<p style='color:red'>حدث خطأ في جلب المباريات. حاول تحديث الصفحة.</p>";
    }
}

// 2. دالة معالجة وعرض المباريات لكل قسم
function processMatches(data, sportType, sectionId, containerId) {
    const container = document.getElementById(containerId);
    const section = document.getElementById(sectionId);
    
    // فلترة البيانات
    const matches = data.filter(match => {
        // التحقق من الحظر
        for (let blocked of blockedLeagues) {
            if (match.league && (blocked.test(match.league) || blocked.test(match.league_en))) return false;
        }
        
        // تصنيف حسب الرياضة
        const isCombat = /UFC|Boxing|MMA|Fight/i.test(match.league);
        if (sportType === 'football') return !isCombat;
        if (sportType === 'ufc') return /UFC|MMA/i.test(match.league);
        if (sportType === 'boxing') return /Boxing/i.test(match.league);
        return false;
    });

    // العرض أو الإخفاء
    if (matches.length > 0) {
        section.style.display = "block"; // إظهار القسم
        container.innerHTML = ""; // تنظيف
        matches.forEach(match => createMatchCard(match, container));
        return matches.length;
    } else {
        section.style.display = "none"; // إخفاء القسم بالكامل
        return 0;
    }
}

// 3. دالة إنشاء بطاقة المباراة HTML
function createMatchCard(data, container) {
    // حساب الحالة والوقت
    let { statusClass, statusText, scoreDisplay } = getMatchStatus(data);
    
    // رابط البث (للاستخدام داخل الـ iframe)
    // الهيكل عادة: url/live/id/match_id
    const watchUrl = `${MAIN_URL_BASE}${data.id}/${data.api_matche_id}`;

    // القنوات
    let channelsHtml = data.tv ? data.tv.split(",").map(c => `<div class='channel-item'>${c}</div>`).join('') : "<div class='channel-item'>غير محدد</div>";

    const card = document.createElement("div");
    card.className = "match-card";
    card.innerHTML = `
        <div class="league-info">
            <img src="${LEAGUE_IMG_URL}${data.league_logo}" onerror="this.style.display='none'">
            <span>${data.league}</span>
        </div>

        <div class="match-row">
            <div class="team-box">
                <img src="${TEAM_IMG_URL}${data.home_logo}" onerror="this.src='https://via.placeholder.com/45'">
                <div class="team-name">${data.home}</div>
            </div>
            
            <div class="center-box">
                <div class="score">${scoreDisplay}</div>
                <span class="match-status ${statusClass}">${statusText}</span>
            </div>
            
            <div class="team-box">
                <img src="${TEAM_IMG_URL}${data.away_logo}" onerror="this.src='https://via.placeholder.com/45'">
                <div class="team-name">${data.away}</div>
            </div>
        </div>

        <div class="actions-row">
            <button class="btn-action btn-channels" onclick="toggleChannels(this)">
                <i class='bx bx-tv'></i> القنوات
            </button>
            <button class="btn-action btn-watch" onclick="openVideo('${watchUrl}')">
                <i class='bx bx-play-circle'></i> مشاهدة
            </button>
        </div>
        <div class="channels-list">${channelsHtml}</div>
    `;
    container.appendChild(card);
}

// 4. دالة مساعدة لحالة المباراة
function getMatchStatus(data) {
    let statusClass = "status-soon", statusText = "لم تبدأ", scoreDisplay = "";
    
    if (data.status == 1) { // مباشر
        statusClass = "status-live"; statusText = "مباشر";
        scoreDisplay = data.score || "0 - 0";
    } else if (data.status == 2) { // انتهت
        statusClass = "status-finished"; statusText = "انتهت";
        scoreDisplay = data.score || "-";
    } else { // لم تبدأ
        // تحسين عرض الوقت (إضافة ساعة +1 أو حسب التوقيت المحلي)
        if (data.time) {
            let [h, m] = data.time.split(":");
            // هنا يمكنك تعديل التوقيت حسب الحاجة. الكود أدناه يعرضه كما هو من المصدر
            scoreDisplay = `${h}:${m}`; 
        }
    }
    return { statusClass, statusText, scoreDisplay };
}

// 5. وظائف واجهة المستخدم (فيديو + قنوات)
function toggleChannels(btn) {
    const list = btn.parentElement.nextElementSibling;
    const allLists = document.querySelectorAll('.channels-list');
    
    // إغلاق القوائم الأخرى
    allLists.forEach(l => {
        if(l !== list) l.classList.remove('active');
    });
    
    list.classList.toggle("active");
}

function showGlobalNoMatches() {
    globalNoMatches.style.display = "block";
}

// --- التعامل مع الفيديو (Embed) ---
const videoModal = document.getElementById("videoModal");
const videoFrame = document.getElementById("videoFrame");

function openVideo(url) {
    videoFrame.src = url;
    videoModal.style.display = "flex";
}

function closeVideo() {
    videoModal.style.display = "none";
    videoFrame.src = ""; // إيقاف الفيديو
}

// إغلاق النافذة عند النقر خارجها
window.onclick = function(event) {
    if (event.target == videoModal) {
        closeVideo();
    }
}

// بدء التنفيذ
document.addEventListener('DOMContentLoaded', fetchMatches);
</script>

</body>
</html>
